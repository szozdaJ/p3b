test lock correctness using nested threads